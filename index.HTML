<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HappyData - Development & Happiness Analytics</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .header {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 20px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 2rem;
            font-weight: bold;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .nav-tabs {
            display: flex;
            gap: 10px;
        }

        .nav-tab {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
        }

        .nav-tab:hover, .nav-tab.active {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .main-content {
            padding: 30px 0;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(600px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }

        .chart-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .chart-title {
            font-size: 1.4rem;
            font-weight: 600;
            color: #2c3e50;
        }

        .controls {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .control-label {
            font-weight: 600;
            color: #34495e;
            font-size: 0.9rem;
        }

        select, input[type="number"] {
            padding: 10px 15px;
            border: 2px solid #e1e8ed;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: white;
        }

        select:focus, input[type="number"]:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 10px rgba(102, 126, 234, 0.2);
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            align-self: end;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .chart-container {
            position: relative;
            height: 400px;
            margin-top: 20px;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 50px;
            color: #7f8c8d;
            font-size: 1.1rem;
        }

        .loading.active {
            display: block;
        }

        .error {
            background: #fee;
            border: 1px solid #fcc;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            color: #c33;
            display: none;
        }

        .error.active {
            display: block;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #7f8c8d;
            font-size: 0.9rem;
        }

        .intro-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .feature-card {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 20px;
            border-left: 4px solid #667eea;
        }

        .responsive-table {
            overflow-x: auto;
            margin-top: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #e1e8ed;
        }

        th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: 600;
        }

        tr:hover {
            background: rgba(102, 126, 234, 0.05);
        }

        .year-range {
            display: flex;
            gap: 10px;
            align-items: end;
        }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 20px;
            }

            .nav-tabs {
                flex-wrap: wrap;
                justify-content: center;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .controls {
                flex-direction: column;
            }

            .year-range {
                flex-direction: column;
                align-items: start;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">üåç HappyData</div>
                <nav class="nav-tabs">
                    <button class="nav-tab active" onclick="showTab('overview')">Overview</button>
                    <button class="nav-tab" onclick="showTab('trends')">Country Trends</button>
                    <button class="nav-tab" onclick="showTab('comparison')">Happiness vs Indicators</button>
                    <button class="nav-tab" onclick="showTab('regional')">Regional Analysis</button>
                    <button class="nav-tab" onclick="showTab('india-dashboard')">India Dashboard</button>
                </nav>
            </div>
        </div>
    </header>

    <main class="main-content">
        <div class="container">
            <!-- Overview Tab -->
            <div id="overview" class="tab-content active">
                <div class="intro-section">
                    <h1>Welcome to HappyData</h1>
                    <p style="font-size: 1.1rem; color: #7f8c8d; margin: 15px 0;">
                        Explore the relationship between development indicators and human well-being across countries and regions.
                        Our platform combines data from the World Happiness Report and World Bank to provide insights into global development patterns.
                    </p>
                    
                    <div class="feature-grid">
                        <div class="feature-card">
                            <h3>üè¢ Country Indicator Trends</h3>
                            <p>Track how development indicators change over time for specific countries</p>
                        </div>
                        <div class="feature-card">
                            <h3>üìä Happiness vs Indicators</h3>
                            <p>Compare happiness levels with various development metrics</p>
                        </div>
                        <div class="feature-card">
                            <h3>üåç Regional Analysis</h3>
                            <p>Explore happiness and development patterns across world regions</p>
                        </div>
                        <div class="feature-card">
                            <h3>üáÆüá≥ India Dashboard</h3>
                            <p>Specialized analytics for India's development and happiness indicators</p>
                        </div>
                    </div>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number">195+</div>
                        <div class="stat-label">Countries Analyzed</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">50+</div>
                        <div class="stat-label">Development Indicators</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">7</div>
                        <div class="stat-label">World Regions</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">2024</div>
                        <div class="stat-label">Latest Data Year</div>
                    </div>
                </div>
            </div>

            <!-- Country Trends Tab -->
            <div id="trends" class="tab-content">
                <div class="chart-card">
                    <div class="chart-header">
                        <h2 class="chart-title">Country Indicator Trends</h2>
                    </div>
                    <div class="controls">
                        <div class="control-group">
                            <label class="control-label">Select Country:</label>
                            <select id="countrySelect">
                                <option value="">Loading countries...</option>
                            </select>
                        </div>
                        <div class="control-group">
                            <label class="control-label">Select Indicator:</label>
                            <select id="indicatorSelect">
                                <option value="NY.GDP.PCAP.CD">GDP per capita (current US$)</option>
                                <option value="SP.POP.TOTL">Population, total</option>
                                <option value="SP.DYN.LE00.IN">Life expectancy at birth, total (years)</option>
                                <option value="SE.ADT.LITR.ZS">Literacy rate, adult total (% of people ages 15 and above)</option>
                                <option value="SH.DYN.MORT">Mortality rate, under-5 (per 1,000 live births)</option>
                                <option value="EG.USE.ELEC.KH.PC">Electric power consumption (kWh per capita)</option>
                            </select>
                        </div>
                        <div class="year-range">
                            <div class="control-group">
                                <label class="control-label">From Year:</label>
                                <input type="number" id="startYear" value="2015" min="2000" max="2023">
                            </div>
                            <div class="control-group">
                                <label class="control-label">To Year:</label>
                                <input type="number" id="endYear" value="2023" min="2000" max="2023">
                            </div>
                        </div>
                        <button class="btn" onclick="loadCountryTrends()">Generate Chart</button>
                    </div>
                    <div id="trendsError" class="error"></div>
                    <div id="trendsLoading" class="loading">Loading data...</div>
                    <div class="chart-container">
                        <canvas id="trendsChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Comparison Tab -->
            <div id="comparison" class="tab-content">
                <div class="chart-card">
                    <div class="chart-header">
                        <h2 class="chart-title">Happiness vs Development Indicators</h2>
                    </div>
                    <div class="controls">
                        <div class="control-group">
                            <label class="control-label">Select Country:</label>
                            <select id="comparisonCountrySelect">
                                <option value="">Loading countries...</option>
                            </select>
                        </div>
                        <div class="control-group">
                            <label class="control-label">Select Indicator:</label>
                            <select id="comparisonIndicatorSelect">
                                <option value="NY.GDP.PCAP.CD">GDP per capita (current US$)</option>
                                <option value="SP.DYN.LE00.IN">Life expectancy at birth, total (years)</option>
                                <option value="SE.ADT.LITR.ZS">Literacy rate, adult total (% of people ages 15 and above)</option>
                                <option value="SH.DYN.MORT">Mortality rate, under-5 (per 1,000 live births)</option>
                                <option value="EG.USE.ELEC.KH.PC">Electric power consumption (kWh per capita)</option>
                            </select>
                        </div>
                        <div class="year-range">
                            <div class="control-group">
                                <label class="control-label">From Year:</label>
                                <input type="number" id="compStartYear" value="2015" min="2000" max="2023">
                            </div>
                            <div class="control-group">
                                <label class="control-label">To Year:</label>
                                <input type="number" id="compEndYear" value="2023" min="2000" max="2023">
                            </div>
                        </div>
                        <button class="btn" onclick="loadComparison()">Generate Comparison</button>
                    </div>
                    <div id="comparisonError" class="error"></div>
                    <div id="comparisonLoading" class="loading">Loading data...</div>
                    <div class="chart-container">
                        <canvas id="comparisonChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Regional Tab -->
            <div id="regional" class="tab-content">
                <div class="dashboard-grid">
                    <div class="chart-card">
                        <div class="chart-header">
                            <h2 class="chart-title">Regional Happiness Distribution</h2>
                        </div>
                        <div class="controls">
                            <div class="control-group">
                                <label class="control-label">Select Year:</label>
                                <input type="number" id="regionalYear" value="2023" min="2015" max="2023">
                            </div>
                            <button class="btn" onclick="loadRegionalHappiness()">Load Data</button>
                        </div>
                        <div id="regionalError" class="error"></div>
                        <div id="regionalLoading" class="loading">Loading data...</div>
                        <div class="chart-container">
                            <canvas id="regionalChart"></canvas>
                        </div>
                    </div>

                    <div class="chart-card">
                        <div class="chart-header">
                            <h2 class="chart-title">Regional Indicator Snapshot</h2>
                        </div>
                        <div class="controls">
                            <div class="control-group">
                                <label class="control-label">Select Region:</label>
                                <select id="regionSelect">
                                    <option value="EAS">East Asia & Pacific</option>
                                    <option value="ECS">Europe & Central Asia</option>
                                    <option value="LCN">Latin America & Caribbean</option>
                                    <option value="MEA">Middle East & North Africa</option>
                                    <option value="NAC">North America</option>
                                    <option value="SAS">South Asia</option>
                                    <option value="SSF">Sub-Saharan Africa</option>
                                </select>
                            </div>
                            <div class="control-group">
                                <label class="control-label">Select Indicator:</label>
                                <select id="regionalIndicatorSelect">
                                    <option value="NY.GDP.PCAP.CD">GDP per capita (current US$)</option>
                                    <option value="SP.DYN.LE00.IN">Life expectancy at birth, total (years)</option>
                                    <option value="SE.ADT.LITR.ZS">Literacy rate, adult total (% of people ages 15 and above)</option>
                                    <option value="SH.DYN.MORT">Mortality rate, under-5 (per 1,000 live births)</option>
                                </select>
                            </div>
                            <div class="control-group">
                                <label class="control-label">Year:</label>
                                <input type="number" id="snapshotYear" value="2023" min="2015" max="2023">
                            </div>
                            <button class="btn" onclick="loadRegionalSnapshot()">Load Snapshot</button>
                        </div>
                        <div id="snapshotError" class="error"></div>
                        <div id="snapshotLoading" class="loading">Loading data...</div>
                        <div class="chart-container">
                            <canvas id="snapshotChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- India Dashboard Tab -->
            <div id="india-dashboard" class="tab-content">
                <div class="intro-section">
                    <h2>India Development & Happiness Dashboard</h2>
                    <p>Specialized analytics showing key indicators that correlate with happiness levels in India</p>
                </div>

                <div class="controls" style="justify-content: center; margin-bottom: 30px;">
                    <div class="year-range">
                        <div class="control-group">
                            <label class="control-label">From Year:</label>
                            <input type="number" id="indiaStartYear" value="2015" min="2000" max="2023">
                        </div>
                        <div class="control-group">
                            <label class="control-label">To Year:</label>
                            <input type="number" id="indiaEndYear" value="2023" min="2000" max="2023">
                        </div>
                    </div>
                    <button class="btn" onclick="loadIndiaDashboard()">Update Dashboard</button>
                </div>

                <div class="dashboard-grid">
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3 class="chart-title">GDP per Capita vs Happiness</h3>
                        </div>
                        <div id="indiaGdpLoading" class="loading">Loading data...</div>
                        <div class="chart-container">
                            <canvas id="indiaGdpChart"></canvas>
                        </div>
                    </div>

                    <div class="chart-card">
                        <div class="chart-header">
                            <h3 class="chart-title">Life Expectancy vs Happiness</h3>
                        </div>
                        <div id="indiaLifeLoading" class="loading">Loading data...</div>
                        <div class="chart-container">
                            <canvas id="indiaLifeChart"></canvas>
                        </div>
                    </div>

                    <div class="chart-card">
                        <div class="chart-header">
                            <h3 class="chart-title">Mortality Rate vs Happiness</h3>
                        </div>
                        <div id="indiaMortLoading" class="loading">Loading data...</div>
                        <div class="chart-container">
                            <canvas id="indiaMortChart"></canvas>
                        </div>
                    </div>

                    <div class="chart-card">
                        <div class="chart-header">
                            <h3 class="chart-title">Literacy Rate vs Happiness</h3>
                        </div>
                        <div id="indiaLitLoading" class="loading">Loading data...</div>
                        <div class="chart-container">
                            <canvas id="indiaLitChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Global variables
        let countries = [];
        let charts = {};
        
        // Sample happiness data (in a real implementation, this would come from the World Happiness Report API)
        const happinessData = {
            'IND': {
                2015: 4.565, 2016: 4.404, 2017: 4.315, 2018: 4.190, 2019: 4.025,
                2020: 3.819, 2021: 4.036, 2022: 4.036, 2023: 4.036
            },
            'USA': {
                2015: 7.119, 2016: 7.104, 2017: 6.993, 2018: 6.886, 2019: 6.940,
                2020: 6.951, 2021: 7.028, 2022: 7.028, 2023: 7.028
            },
            'CHN': {
                2015: 5.273, 2016: 5.245, 2017: 5.204, 2018: 5.191, 2019: 5.124,
                2020: 5.124, 2021: 5.585, 2022: 5.585, 2023: 5.585
            },
            'GBR': {
                2015: 6.867, 2016: 6.725, 2017: 6.814, 2018: 7.054, 2019: 7.165,
                2020: 7.064, 2021: 7.064, 2022: 7.064, 2023: 7.064
            },
            'JPN': {
                2015: 5.987, 2016: 5.915, 2017: 5.920, 2018: 5.915, 2019: 5.871,
                2020: 5.940, 2021: 6.039, 2022: 6.039, 2023: 6.039
            }
        };

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            loadCountries();
        });

        // Tab switching functionality
        function showTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all nav tabs
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab content
            document.getElementById(tabName).classList.add('active');
            
            // Add active class to clicked nav tab
            event.target.classList.add('active');
        }

        // Load countries from World Bank API
        async function loadCountries() {
            try {
                const response = await fetch('https://api.worldbank.org/v2/country?format=json&per_page=300');
                const data = await response.json();
                countries = data[1].filter(country => 
                    country.capitalCity && country.incomeLevel.id !== 'INX'
                );
                
                populateCountrySelectors();
            } catch (error) {
                console.error('Error loading countries:', error);
                // Fallback to basic country list
                countries = [
                    {id: 'IND', name: 'India'},
                    {id: 'USA', name: 'United States'},
                    {id: 'CHN', name: 'China'},
                    {id: 'GBR', name: 'United Kingdom'},
                    {id: 'JPN', name: 'Japan'},
                    {id: 'DEU', name: 'Germany'},
                    {id: 'FRA', name: 'France'},
                    {id: 'BRA', name: 'Brazil'},
                    {id: 'RUS', name: 'Russian Federation'},
                    {id: 'AUS', name: 'Australia'}
                ];
                populateCountrySelectors();
            }
        }

        // Populate country selector dropdowns
        function populateCountrySelectors() {
            const selectors = ['countrySelect', 'comparisonCountrySelect'];
            
            selectors.forEach(selectorId => {
                const selector = document.getElementById(selectorId);
                selector.innerHTML = '<option value="">Select a country...</option>';
                
                countries.forEach(country => {
                    const option = document.createElement('option');
                    option.value = country.id;
                    option.textContent = country.name;
                    selector.appendChild(option);
                });
            });
        }

        // Utility function to show error messages
        function showError(elementId, message) {
            const errorElement = document.getElementById(elementId);
            errorElement.textContent = message;
            errorElement.classList.add('active');
        }

        // Utility function to hide error messages
        function hideError(elementId) {
            const errorElement = document.getElementById(elementId);
            errorElement.classList.remove('active');
        }

        // Utility function to show loading state
        function showLoading(elementId) {
            document.getElementById(elementId).classList.add('active');
        }

        // Utility function to hide loading state
        function hideLoading(elementId) {
            document.getElementById(elementId).classList.remove('active');
        }

        // Load country trends data
        async function loadCountryTrends() {
            const country = document.getElementById('countrySelect').value;
            const indicator = document.getElementById('indicatorSelect').value;
            const startYear = document.getElementById('startYear').value;
            const endYear = document.getElementById('endYear').value;

            if (!country) {
                showError('trendsError', 'Please select a country');
                return;
            }

            hideError('trendsError');
            showLoading('trendsLoading');

            try {
                const response = await fetch(
                    `https://api.worldbank.org/v2/country/${country}/indicator/${indicator}?date=${startYear}:${endYear}&format=json`
                );
                const data = await response.json();

                if (data[1] && data[1].length > 0) {
                    const chartData = data[1]
                        .filter(item => item.value !== null)
                        .reverse()
                        .map(item => ({
                            year: item.date,
                            value: item.value
                        }));

                    createTrendsChart(chartData, country, indicator);
                } else {
                    showError('trendsError', 'No data available for selected parameters');
                }
            } catch (error) {
                showError('trendsError', 'Error loading data: ' + error.message);
            } finally {
                hideLoading('trendsLoading');
            }
        }

        // Create trends chart
        function createTrendsChart(data, country, indicator) {
            const ctx = document.getElementById('trendsChart').getContext('2d');
            
            // Destroy existing chart if it exists
            if (charts.trends) {
                charts.trends.destroy();
                charts.trends = null;
            }

            const indicatorName = document.getElementById('indicatorSelect').selectedOptions[0].text;
            const countryName = countries.find(c => c.id === country)?.name || country;

            charts.trends = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.map(item => item.year),
                    datasets: [{
                        label: indicatorName,
                        data: data.map(item => item.value),
                        borderColor: 'rgb(102, 126, 234)',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: `${indicatorName} - ${countryName}`,
                            font: {
                                size: 16,
                                weight: 'bold'
                            }
                        },
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            grid: {
                                color: 'rgba(0,0,0,0.1)'
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(0,0,0,0.1)'
                            }
                        }
                    }
                }
            });
        }

        // Load comparison data (Happiness vs Indicator)
        async function loadComparison() {
            const country = document.getElementById('comparisonCountrySelect').value;
            const indicator = document.getElementById('comparisonIndicatorSelect').value;
            const startYear = document.getElementById('compStartYear').value;
            const endYear = document.getElementById('compEndYear').value;

            if (!country) {
                showError('comparisonError', 'Please select a country');
                return;
            }

            hideError('comparisonError');
            showLoading('comparisonLoading');

            try {
                // Load World Bank indicator data
                const response = await fetch(
                    `https://api.worldbank.org/v2/country/${country}/indicator/${indicator}?date=${startYear}:${endYear}&format=json`
                );
                const indicatorData = await response.json();

                if (indicatorData[1] && indicatorData[1].length > 0) {
                    const years = [];
                    const indicatorValues = [];
                    const happinessValues = [];

                    // Combine indicator data with happiness data
                    indicatorData[1]
                        .filter(item => item.value !== null)
                        .reverse()
                        .forEach(item => {
                            if (happinessData[country] && happinessData[country][item.date]) {
                                years.push(item.date);
                                indicatorValues.push(item.value);
                                happinessValues.push(happinessData[country][item.date]);
                            }
                        });

                    if (years.length > 0) {
                        createComparisonChart(years, indicatorValues, happinessValues, country, indicator);
                    } else {
                        showError('comparisonError', 'No overlapping data available for happiness and selected indicator');
                    }
                } else {
                    showError('comparisonError', 'No indicator data available for selected parameters');
                }
            } catch (error) {
                showError('comparisonError', 'Error loading data: ' + error.message);
            } finally {
                hideLoading('comparisonLoading');
            }
        }

        // Create comparison chart
        function createComparisonChart(years, indicatorValues, happinessValues, country, indicator) {
            const ctx = document.getElementById('comparisonChart').getContext('2d');
            
            // Destroy existing chart if it exists
            if (charts.comparison) {
                charts.comparison.destroy();
                charts.comparison = null;
            }

            const indicatorName = document.getElementById('comparisonIndicatorSelect').selectedOptions[0].text;
            const countryName = countries.find(c => c.id === country)?.name || country;

            charts.comparison = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: years,
                    datasets: [{
                        label: indicatorName,
                        data: indicatorValues,
                        borderColor: 'rgb(102, 126, 234)',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        borderWidth: 3,
                        yAxisID: 'y',
                        tension: 0.4
                    }, {
                        label: 'Happiness Score',
                        data: happinessValues,
                        borderColor: 'rgb(255, 99, 132)',
                        backgroundColor: 'rgba(255, 99, 132, 0.1)',
                        borderWidth: 3,
                        yAxisID: 'y1',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: `${indicatorName} vs Happiness - ${countryName}`,
                            font: {
                                size: 16,
                                weight: 'bold'
                            }
                        }
                    },
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: indicatorName
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: 'Happiness Score'
                            },
                            grid: {
                                drawOnChartArea: false,
                            },
                        }
                    }
                }
            });
        }

        // Load regional happiness data
        async function loadRegionalHappiness() {
            const year = document.getElementById('regionalYear').value;

            hideError('regionalError');
            showLoading('regionalLoading');

            try {
                // Simulate regional happiness data (in real implementation, would fetch from World Happiness Report)
                const regionalData = [
                    { region: 'North America', happiness: 7.2, countries: ['USA', 'CAN'] },
                    { region: 'Europe & Central Asia', happiness: 6.8, countries: ['GBR', 'DEU', 'FRA'] },
                    { region: 'East Asia & Pacific', happiness: 5.6, countries: ['JPN', 'CHN', 'AUS'] },
                    { region: 'Latin America & Caribbean', happiness: 6.1, countries: ['BRA', 'MEX'] },
                    { region: 'Middle East & North Africa', happiness: 5.3, countries: ['TUR', 'EGY'] },
                    { region: 'South Asia', happiness: 4.5, countries: ['IND', 'BGD'] },
                    { region: 'Sub-Saharan Africa', happiness: 4.2, countries: ['NGA', 'KEN'] }
                ];

                createRegionalChart(regionalData);
            } catch (error) {
                showError('regionalError', 'Error loading regional data: ' + error.message);
            } finally {
                hideLoading('regionalLoading');
            }
        }

        // Create regional happiness chart
        function createRegionalChart(data) {
            const ctx = document.getElementById('regionalChart').getContext('2d');
            
            // Destroy existing chart if it exists
            if (charts.regional) {
                charts.regional.destroy();
                charts.regional = null;
            }

            charts.regional = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.map(item => item.region),
                    datasets: [{
                        label: 'Average Happiness Score',
                        data: data.map(item => item.happiness),
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.8)',
                            'rgba(54, 162, 235, 0.8)',
                            'rgba(255, 205, 86, 0.8)',
                            'rgba(75, 192, 192, 0.8)',
                            'rgba(153, 102, 255, 0.8)',
                            'rgba(255, 159, 64, 0.8)',
                            'rgba(199, 199, 199, 0.8)'
                        ],
                        borderColor: [
                            'rgba(255, 99, 132, 1)',
                            'rgba(54, 162, 235, 1)',
                            'rgba(255, 205, 86, 1)',
                            'rgba(75, 192, 192, 1)',
                            'rgba(153, 102, 255, 1)',
                            'rgba(255, 159, 64, 1)',
                            'rgba(199, 199, 199, 1)'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: `Regional Happiness Distribution (${document.getElementById('regionalYear').value})`,
                            font: {
                                size: 16,
                                weight: 'bold'
                            }
                        },
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 8,
                            title: {
                                display: true,
                                text: 'Happiness Score'
                            }
                        },
                        x: {
                            ticks: {
                                maxRotation: 45
                            }
                        }
                    }
                }
            });
        }

        // Load regional snapshot data
        async function loadRegionalSnapshot() {
            const region = document.getElementById('regionSelect').value;
            const indicator = document.getElementById('regionalIndicatorSelect').value;
            const year = document.getElementById('snapshotYear').value;

            hideError('snapshotError');
            showLoading('snapshotLoading');

            try {
                // Get countries in the selected region
                const regionCountries = {
                    'EAS': ['CHN', 'JPN', 'IDN', 'THA', 'VNM'],
                    'ECS': ['DEU', 'GBR', 'FRA', 'ITA', 'ESP'],
                    'LCN': ['BRA', 'MEX', 'ARG', 'COL', 'PER'],
                    'MEA': ['TUR', 'EGY', 'IRN', 'DZA', 'MAR'],
                    'NAC': ['USA', 'CAN'],
                    'SAS': ['IND', 'PAK', 'BGD', 'LKA', 'NPL'],
                    'SSF': ['NGA', 'ETH', 'ZAF', 'KEN', 'UGA']
                };

                const countriesInRegion = regionCountries[region] || [];
                
                // Simulate data for countries in the region
                const snapshotData = [];
                for (const countryCode of countriesInRegion.slice(0, 5)) {
                    const country = countries.find(c => c.id === countryCode) || { name: countryCode };
                    let value;
                    
                    // Generate realistic sample data based on indicator type
                    switch(indicator) {
                        case 'NY.GDP.PCAP.CD':
                            value = Math.random() * 50000 + 5000;
                            break;
                        case 'SP.DYN.LE00.IN':
                            value = Math.random() * 25 + 60;
                            break;
                        case 'SE.ADT.LITR.ZS':
                            value = Math.random() * 40 + 60;
                            break;
                        case 'SH.DYN.MORT':
                            value = Math.random() * 80 + 10;
                            break;
                        default:
                            value = Math.random() * 100;
                    }
                    
                    snapshotData.push({
                        country: country.name,
                        value: Math.round(value * 100) / 100
                    });
                }

                createSnapshotChart(snapshotData, region, indicator, year);
            } catch (error) {
                showError('snapshotError', 'Error loading snapshot data: ' + error.message);
            } finally {
                hideLoading('snapshotLoading');
            }
        }

        // Create regional snapshot chart
        function createSnapshotChart(data, region, indicator, year) {
            const ctx = document.getElementById('snapshotChart').getContext('2d');
            
            // Destroy existing chart if it exists
            if (charts.snapshot) {
                charts.snapshot.destroy();
                charts.snapshot = null;
            }

            const indicatorName = document.getElementById('regionalIndicatorSelect').selectedOptions[0].text;
            const regionName = document.getElementById('regionSelect').selectedOptions[0].text;

            charts.snapshot = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.map(item => item.country),
                    datasets: [{
                        label: indicatorName,
                        data: data.map(item => item.value),
                        backgroundColor: 'rgba(102, 126, 234, 0.8)',
                        borderColor: 'rgba(102, 126, 234, 1)',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: `${indicatorName} in ${regionName} (${year})`,
                            font: {
                                size: 16,
                                weight: 'bold'
                            }
                        },
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: indicatorName
                            }
                        }
                    }
                }
            });
        }

        // Load India dashboard data
        async function loadIndiaDashboard() {
            const startYear = document.getElementById('indiaStartYear').value;
            const endYear = document.getElementById('indiaEndYear').value;
            
            const indicators = [
                { id: 'NY.GDP.PCAP.CD', chartId: 'indiaGdpChart', loadingId: 'indiaGdpLoading', name: 'GDP per Capita' },
                { id: 'SP.DYN.LE00.IN', chartId: 'indiaLifeChart', loadingId: 'indiaLifeLoading', name: 'Life Expectancy' },
                { id: 'SH.DYN.MORT', chartId: 'indiaMortChart', loadingId: 'indiaMortLoading', name: 'Mortality Rate' },
                { id: 'SE.ADT.LITR.ZS', chartId: 'indiaLitChart', loadingId: 'indiaLitLoading', name: 'Literacy Rate' }
            ];

            // Load all indicators for India
            indicators.forEach(async (indicator, index) => {
                showLoading(indicator.loadingId);
                
                try {
                    const response = await fetch(
                        `https://api.worldbank.org/v2/country/IND/indicator/${indicator.id}?date=${startYear}:${endYear}&format=json`
                    );
                    const data = await response.json();

                    if (data[1] && data[1].length > 0) {
                        const years = [];
                        const indicatorValues = [];
                        const happinessValues = [];

                        data[1]
                            .filter(item => item.value !== null)
                            .reverse()
                            .forEach(item => {
                                if (happinessData['IND'] && happinessData['IND'][item.date]) {
                                    years.push(item.date);
                                    indicatorValues.push(item.value);
                                    happinessValues.push(happinessData['IND'][item.date]);
                                }
                            });

                        createIndiaChart(indicator.chartId, years, indicatorValues, happinessValues, indicator.name);
                    } else {
                        // Use sample data if API fails
                        createSampleIndiaChart(indicator.chartId, indicator.name, startYear, endYear);
                    }
                } catch (error) {
                    // Use sample data if API fails
                    createSampleIndiaChart(indicator.chartId, indicator.name, startYear, endYear);
                } finally {
                    hideLoading(indicator.loadingId);
                }
            });
        }

        // Create India dashboard chart
        function createIndiaChart(chartId, years, indicatorValues, happinessValues, indicatorName) {
            const ctx = document.getElementById(chartId).getContext('2d');
            
            // Destroy existing chart if it exists
            if (charts[chartId]) {
                charts[chartId].destroy();
                charts[chartId] = null;
            }

            charts[chartId] = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: years,
                    datasets: [{
                        label: indicatorName,
                        data: indicatorValues,
                        borderColor: 'rgb(102, 126, 234)',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        borderWidth: 3,
                        yAxisID: 'y',
                        tension: 0.4
                    }, {
                        label: 'Happiness Score',
                        data: happinessValues,
                        borderColor: 'rgb(255, 99, 132)',
                        backgroundColor: 'rgba(255, 99, 132, 0.1)',
                        borderWidth: 3,
                        yAxisID: 'y1',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top'
                        }
                    },
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            grid: {
                                drawOnChartArea: false,
                            },
                        }
                    }
                }
            });
        }

        // Create sample India chart (fallback)
        function createSampleIndiaChart(chartId, indicatorName, startYear, endYear) {
            const years = [];
            const indicatorValues = [];
            const happinessValues = [];

            for (let year = parseInt(startYear); year <= parseInt(endYear); year++) {
                years.push(year.toString());
                
                // Generate sample data based on indicator type
                let value;
                switch(indicatorName) {
                    case 'GDP per Capita':
                        value = 1500 + (year - 2015) * 100 + Math.random() * 200;
                        break;
                    case 'Life Expectancy':
                        value = 68 + (year - 2015) * 0.2 + Math.random() * 1;
                        break;
                    case 'Mortality Rate':
                        value = 40 - (year - 2015) * 2 + Math.random() * 3;
                        break;
                    case 'Literacy Rate':
                        value = 70 + (year - 2015) * 1.5 + Math.random() * 2;
                        break;
                    default:
                        value = Math.random() * 100;
                }
                
                indicatorValues.push(Math.round(value * 100) / 100);
                happinessValues.push(happinessData['IND'][year] || 4.0);
            }

            createIndiaChart(chartId, years, indicatorValues, happinessValues, indicatorName);
        }

        // Initialize India dashboard on page load
        setTimeout(() => {
            loadIndiaDashboard();
        }, 1000);
    </script>
</body>
</html>